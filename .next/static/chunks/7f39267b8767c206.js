(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23832,e=>{"use strict";var t=e.i(43476);e.i(20344);var n=e.i(71482);e.i(50711);var r=e.i(81958),l=e.i(71645);let i=(0,l.createContext)(void 0),a=(0,l.createContext)(void 0);function o(){return(0,l.useContext)(a)}let u=(0,l.createContext)(null),s="__convexAuthOAuthVerifier",c="__convexAuthJWT",d="__convexAuthRefreshToken",h="__convexAuthServerStateFetchTime";function v({client:e,serverState:n,onChange:r,storage:o,storageNamespace:v,replaceURL:g,children:f}){var x,k;let y,b,_,A,S=(0,l.useRef)(n?._state.token??null),[p,R]=(0,l.useState)(null===S.current),[P,T]=(0,l.useState)(S.current),I=e.verbose??!1,M=(0,l.useCallback)(e=>{I&&console.debug(`${new Date().toISOString()} ${e}`)},[I]),{storageSet:$,storageGet:j,storageRemove:E,storageKey:L}=(x=o,k=v,y=function(){let[e,t]=(0,l.useState)({});return()=>({getItem:t=>e[t],setItem:(e,n)=>{t(t=>({...t,[e]:n}))},removeItem:e=>{t(t=>{let{[e]:n,...r}=t;return r})}})}(),b=(0,l.useMemo)(()=>x??y(),[x]),_=k.replace(/[^a-zA-Z0-9]/g,""),A=(0,l.useCallback)(e=>`${e}_${_}`,[k]),{storageSet:(0,l.useCallback)((e,t)=>b.setItem(A(e),t),[b,A]),storageGet:(0,l.useCallback)(e=>b.getItem(A(e)),[b,A]),storageRemove:(0,l.useCallback)(e=>b.removeItem(A(e)),[b,A]),storageKey:A}),[U,O]=(0,l.useState)(!1),F=(0,l.useCallback)(async e=>{let t,n=null!==S.current;if(null===e.tokens)S.current=null,e.shouldStore&&(await E(c),await E(d)),t=null;else{let{token:n}=e.tokens;if(S.current=n,e.shouldStore){let{refreshToken:t}=e.tokens;await $(c,n),await $(d,t)}t=n}n!==(null!==t)&&await r?.(),T(t),R(!1)},[$,E]);(0,l.useEffect)(()=>{let e=async e=>{if(U)return e.preventDefault(),e.returnValue=!0,"Are you sure you want to leave? Your changes may not be saved."};return C("beforeunload",e),()=>{m("beforeunload",e)}}),(0,l.useEffect)(()=>{let e=e=>{(async()=>{if(e.storageArea===o&&e.key===L(c)){let t=e.newValue;M(`synced access token, is null: ${null===t}`),await F({shouldStore:!1,tokens:null===t?null:{token:t}})}})()};return C("storage",e),()=>m("storage",e)},[F]);let D=(0,l.useCallback)(async t=>{let{tokens:n}=await e.unauthenticatedCall("auth:signIn","code"in t?{params:{code:t.code},verifier:t.verifier}:t);return M(`retrieved tokens, is null: ${null===n}`),await F({shouldStore:!0,tokens:n??null}),null!==n},[e,F]),V=(0,l.useCallback)(async(t,n)=>{let r=n instanceof FormData?Array.from(n.entries()).reduce((e,[t,n])=>(e[t]=n,e),{}):n??{},l=await j(s)??void 0;await E(s);let i=await e.authenticatedCall("auth:signIn",{provider:t,params:r,verifier:l});if(void 0!==i.redirect){let e=new URL(i.redirect);return await $(s,i.verifier),void 0!==window.location&&(window.location.href=e.toString()),{signingIn:!1,redirect:e}}if(void 0!==i.tokens){let{tokens:e}=i;return M(`signed in and got tokens, is null: ${null===e}`),await F({shouldStore:!0,tokens:e}),{signingIn:null!==i.tokens}}return{signingIn:!1}},[e,F,j]),B=(0,l.useCallback)(async()=>{try{await e.authenticatedCall("auth:signOut")}catch(e){}M("signed out, erasing tokens"),await F({shouldStore:!0,tokens:null})},[F,e]),K=(0,l.useCallback)(async({forceRefreshToken:e})=>{if(e){let e=S.current;return await w(d,async()=>{let t=S.current;if(t!==e)return M(`returning synced token, is null: ${null===t}`),t;let n=await j(d)??null;return null!==n?(O(!0),await D({refreshToken:n}).finally(()=>{O(!1)}),M(`returning retrieved token, is null: ${null===t}`),S.current):(O(!1),M("returning null, there is no refresh token"),null)})}return S.current},[D,B,j]),W=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(void 0===o)throw Error("`localStorage` is not available in this environment, set the `storage` prop on `ConvexAuthProvider`!");let e=async()=>{let e=await j(c)??null;M(`retrieved token from storage, is null: ${null===e}`),await F({shouldStore:!1,tokens:null===e?null:{token:e}})};if(void 0!==n){let t=j(h),r=t=>{if(!t||n._timeFetched>+t){let{token:e,refreshToken:t}=n._state;$(h,n._timeFetched.toString()),F({tokens:null===e||null===t?null:{token:e,refreshToken:t},shouldStore:!0})}else e()};t instanceof Promise?t.then(r):r(t);return}let t=void 0!==window?.location?new URLSearchParams(window.location.search).get("code"):null;if(W.current||t){if(t&&!W.current){W.current=!0;let e=new URL(window.location.href);e.searchParams.delete("code"),(async()=>{await g(e.pathname+e.search+e.hash),await V(void 0,{code:t}),W.current=!1})()}}else e()},[e,j]);let q=(0,l.useMemo)(()=>({signIn:V,signOut:B}),[V,B]),z=null!==P,G=(0,l.useMemo)(()=>({isLoading:p,isAuthenticated:z,fetchAccessToken:K}),[K,p,z]);return(0,t.jsx)(a.Provider,{value:G,children:(0,t.jsx)(i.Provider,{value:q,children:(0,t.jsx)(u.Provider,{value:P,children:f})})})}async function w(e,t){let n=window?.navigator?.locks;return void 0!==n?await n.request(e,t):await k(e,t)}function g(e){void 0===globalThis.__convexAuthMutexes&&(globalThis.__convexAuthMutexes={});let t=globalThis.__convexAuthMutexes[e];return void 0===t&&(globalThis.__convexAuthMutexes[e]={currentlyRunning:null,waiting:[]}),t=globalThis.__convexAuthMutexes[e]}function f(e,t){globalThis.__convexAuthMutexes[e]=t}async function x(e,t){let n=g(e);null===n.currentlyRunning?f(e,{currentlyRunning:t().finally(()=>{let t=g(e).waiting.shift();g(e).currentlyRunning=null,f(e,{...g(e),currentlyRunning:void 0===t?null:x(e,t)})}),waiting:[]}):f(e,{...n,waiting:[...n.waiting,t]})}async function k(e,t){return new Promise((n,r)=>{x(e,()=>t().then(e=>n(e)).catch(e=>r(e)))})}function C(e,t,n){window.addEventListener?.(e,t,n)}function m(e,t,n){window.removeEventListener?.(e,t,n)}function y(){return(0,l.useContext)(i)}function b(e){let{client:i,storage:a,storageNamespace:u,replaceURL:s,children:c}=e,d=(0,l.useMemo)(()=>({authenticatedCall:(e,t)=>i.action(e,t),unauthenticatedCall:(e,t)=>new n.ConvexHttpClient(i.address).action(e,t),verbose:i.options?.verbose}),[i]);return(0,t.jsx)(v,{client:d,storage:a??("undefined"==typeof window?void 0:window?.localStorage),storageNamespace:u??i.address,replaceURL:s??(e=>{window.history.replaceState({},"",e)}),children:(0,t.jsx)(r.ConvexProviderWithAuth,{client:i,useAuth:o,children:c})})}e.s(["ConvexAuthProvider",()=>b,"useAuthActions",()=>y],23832)},44636,e=>{"use strict";var t=e.i(43476),n=e.i(23832);e.i(50711);let r=new(e.i(82045)).ConvexReactClient("https://notable-turtle-553.convex.cloud");function l({children:e}){return(0,t.jsx)(n.ConvexAuthProvider,{client:r,children:e})}e.s(["ConvexClientProvider",()=>l])}]);